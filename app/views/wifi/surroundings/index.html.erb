<div class="container" >
  <div class="row mbot30">
    <div class="col-lg-5 col-xs-12 col-centered">

    	<div class="row span5 col-centered rim_seBox">
    		<form class="form-inline">
	    		<div class="form-group col-lg-4 col-xs-4">
	          <%= select_tag "distance", options_for_select(@distances, @distances.first), class: "form-control" %>
	        </div>
	        <div class="form-group col-lg-4 col-xs-4">
	        	<%= select_tag "industry", options_for_select(@industries, @industries.first),
	        	class: "form-control" %>
	        </div>
	        <div class="form-group col-lg-4 col-xs-4">
	        	<%= select_tag "order_by", options_for_select(@order_bys, @order_bys.first),
	        	class: "form-control" %>
	    		</div>
	    	</form>
    	</div>

    	<div class="row span5 col-centered surrounding_merchants wifi_sections" id="surrounding_merchants">
    		<% @merchant_infos.each do |merchant_info| %>
    				<% activities = merchant_info.merchant.activities.actived %>
	    			<section class="panel">
	            <header class="panel-heading">
	              <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse<%= merchant_info.id %>">
		               <h3 style="color:#f0ad4e"><%= merchant_info.name %></h3>
		               <p><%= merchant_info.shop_description %>
		               </p>
		               <div>
   		               <span style="margin-left:10px;font-size:15px;color:#518616"><%= image_tag "map_03.png", style:"margin-right:5px;height:20px;" %><%= merchant_info.address %></span>
		              	 <span class="pull-right detail">详细 <%= fa_icon "angle-double-down" %></span>
		               </div>
	               </a>
	            </header>
	            <div id="collapse<%= merchant_info.id %>" class="panel-collapse collapse">
		            <div class="panel-body">
		            	
		            	<% activities.each_with_index do |activity,index| %>
		            		<h4><%= activity.title %></h4>
		            		<span class="duration"><%= activity.started_at %> ~ <%= activity.end_at %></span>
		               	<% if activity.cover %>  
		                  <%= image_tag activity.cover.url(:small) %>
		                <% end %>
		                <%= activity.description %>
		                <% if index != activities.size - 1 %>
		                <hr size="1" noshade="noshade" style="border:1px #cccccc dotted;">
		                <% end %>
		            	<% end %>
	            	</div>
	            </div>
	        </section>
    		<% end %>
    	</div>

    	<div id="loaderCircle" class="row span5 col-centered" style="display:none">
    		<%= image_tag "loading.gif" %>
    	</div>

    </div>
  </div>
</div>

<script>

	$( document ).ready(function() {
		$( "#distance" ).change(function(event) {
			onSearch();
		});
		$( "#industry" ).change(function(event) {
			onSearch();
		});
		$( "#order_by" ).change(function(event) {
			onSearch();
		});
	});

	window._token = '<%= form_authenticity_token %>'
	var handler = null;
  var page = 1;

	function onSearch(){
		page = 1;
		$('#surrounding_merchants').html("");
		loadData();
	}
   
  function loadData() {
	  $('#loaderCircle').show();
	  var distance = $('#distance').val();
	  var industry = $('#industry').val();
	  var order_by = $('#order_by').val();
    $.ajax({
      url: '/wifi/surroundings/load.js',
      data: { authenticity_token: window._token,
      			distance: distance,
      			industry: industry,
      			order_by: order_by,
      			mid: '<%= params[:mid] %>',
      			vtoken: '<%= params[:vtoken] %>' }
    });
  };

</script>